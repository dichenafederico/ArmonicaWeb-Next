"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[895],{6895:function(t,e,o){o.r(e),o.d(e,{default:function(){return f}});var n=o(5893),i=o(7294),a=o(5570);window.AudioContext=window.AudioContext||window.webkitAudioContext;var r=null,s=null,l=!1,c=null,d=null,u=null,m=null,w=new Float32Array(1024),h=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"];class f extends i.Component{componentDidMount(){window.AudioContext=window.AudioContext||window.webkitAudioContext,navigator.permissions.query({name:"microphone"}).then((function(t){"granted"==t.state?(window.AudioContext=window.AudioContext||window.webkitAudioContext,r=new AudioContext,Math.max(4,Math.floor(r.sampleRate/5e3))):"prompt"==t.state||t.state})),navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(this.gotStream.bind(this))}error(){alert("Stream generation failed.")}getUserMedia(t,e){try{navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia(t,e,this.error)}catch(o){alert("getUserMedia threw exception :"+o)}}updatePitch(t){new Array;d.getFloatTimeDomainData(w);var e=this.autoCorrelate(w,r.sampleRate);if(-1==e);else{s=e;Math.round(s);var o=this.noteFromPitch(s),n=h[o%12],i=this.centsOffFromPitch(s,o);if(this.state.microfonoActivo?this.props.handlerNotaAudio(n,i):this.props.handlerNotaAudio(null,0),0==i);else if(i<0);else Math.abs(i)}window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame),m=window.requestAnimationFrame(this.updatePitch.bind(this))}gotStream(t){window.AudioContext=window.AudioContext||window.webkitAudioContext,r=new AudioContext,Math.max(4,Math.floor(r.sampleRate/5e3)),u=r.createMediaStreamSource(t),(d=r.createAnalyser()).fftSize=2048,d.maxDecibels=-25,d.minDecibels=-60,d.smoothingTimeConstant=.5,u.connect(d),this.setState({stream:u}),this.updatePitch()}toggleOscillator(){return l?(c.stop(0),c=null,d=null,l=!1,window.cancelAnimationFrame||(window.cancelAnimationFrame=window.webkitCancelAnimationFrame),window.cancelAnimationFrame(m),"play oscillator"):(c=r.createOscillator(),(d=r.createAnalyser()).fftSize=2048,c.connect(d),d.connect(r.destination),c.start(0),l=!0,!1,this.updatePitch(),"stop")}toggleLiveInput(){l&&(c.stop(0),c=null,d=null,l=!1,window.cancelAnimationFrame||(window.cancelAnimationFrame=window.webkitCancelAnimationFrame),window.cancelAnimationFrame(m)),this.getUserMedia({audio:{mandatory:{googEchoCancellation:"false",googAutoGainControl:"false",googNoiseSuppression:"true",googHighpassFilter:"false"},optional:[]}},this.gotStream)}togglePlayback(){return l?(c.stop(0),c=null,d=null,l=!1,window.cancelAnimationFrame||(window.cancelAnimationFrame=window.webkitCancelAnimationFrame),window.cancelAnimationFrame(m),"start"):((c=r.createBufferSource()).buffer=null,c.loop=!0,(d=r.createAnalyser()).fftSize=2048,c.connect(d),d.connect(r.destination),c.start(0),l=!0,!1,this.updatePitch(),"stop")}noteFromPitch(t){var e=Math.log(t/440)/Math.log(2)*12;return Math.round(e)+69}centsOffFromPitch(t,e){return Math.floor(1200*Math.log(t/this.frequencyFromNoteNumber(e))/Math.log(2))}frequencyFromNoteNumber(t){return 440*Math.pow(2,(t-69)/12)}autoCorrelate(t,e){for(var o=t.length,n=Math.floor(o/2),i=0,a=0;a<o;a++){i+=(d=t[a])*d}if((i=Math.sqrt(i/o))<.08)return-1;var r=-1,s=0,l=!1,c=new Array(n);for(a=0;a<o;a++){var d;i+=(d=t[a])*d}if((i=Math.sqrt(i/o))<.01)return-1;for(var u=1,m=0;m<n;m++){var w=0;for(a=0;a<n;a++)w+=Math.abs(t[a]-t[a+m]);if(w=1-w/n,c[m]=w,w>.9&&w>u)l=!0,w>s&&(s=w,r=m);else if(l){return e/(r+8*((c[r+1]-c[r-1])/c[r]))}u=w}return s>.01?e/r:-1}render(){return(0,n.jsx)("div",{style:{marginTop:"15px"},children:(0,n.jsx)(a.Z,{stream:this.state.stream,handlerMicrofono:this.cambiarEstadoMicrofono})})}constructor(t){super(t),this.cambiarEstadoMicrofono=t=>{this.setState({microfonoActivo:t})},this.state={stram:u,microfonoActivo:!1}}}}}]);